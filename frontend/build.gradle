task yarnInstall(type: Exec) {
	inputs.file 'package.json'
	outputs.file 'yarn.lock'
	commandLine 'yarn'
}

// TODO: figure out how to build DLLs once
// (maybe just use commons-chunks instead)

['bucs', 'busun'].each { conference ->
	task "build${conference.capitalize()}Dlls"(type: Exec) {
		inputs.file 'yarn.lock'
		inputs.dir 'tooling'
		outputs.dir 'dist'

		commandLine 'yarn', 'run', 'dll:prod'

		environment 'CONFERENCE', conference

		dependsOn yarnInstall
	}

	task "assemble${conference.capitalize()}"(type: Exec) {
		inputs.dir 'src'
		inputs.dir 'flow'
		inputs.dir 'tooling'
		outputs.dir 'dist'

		commandLine 'yarn', 'run', 'build:prod'

		environment 'CONFERENCE', conference

		dependsOn "build${conference.capitalize()}Dlls"
		dependsOn yarnInstall
	}
}

task assemble(dependsOn: [assembleBucs, assembleBusun])

//
//task test(type: Exec) {
//	inputs.dir 'src'
//	inputs.dir 'flow'
//
//	commandLine 'yarn', 'test'
//
//	dependsOn yarnInstall
//}
//
//task check {
//	dependsOn test
//}

task build {
	dependsOn assemble
//	dependsOn check
}

task clean(type: Delete) {
	delete 'dist'
}
